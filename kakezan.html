<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>計算クイズ</title>
    <style>
      body {
        width: auto;
        height: auto;
      }
      .hidden {
        display: none;
      }
      #quiz-menu input {
        background-color:#0000FF;
        color:#FFFFFF;
        width:150px;
        height:30px;
        border-radius:10px;
        border:none;
        margin:5px;
      }
      #quiz-container input{
        background-color:#000FFF;
        color:#FFFFFF;
        width:150px;
        height:30px;
        border-radius:10px;
        border:none;
        margin:5px;
      }
    </style>
  </head>
  <body>
    <h1>計算クイズ</h1>
    <br />
    <p id="instruction">どれか選んでね</p>

    <div id="quiz-menu">
      <input type="button" onclick="startQuiz('plus')" value="たしざん">
      <input type="button" onclick="startQuiz('minus')" value="ひきざん">
      <br>
      <input type="button" onclick="startQuiz('times')" value="かけざん">
      <input type="button" onclick="startQuiz('divide')" value="わりざん">
    </div>

    <div id="quiz-container"></div>

    <script>
      let currentAnswer = 0;
      let currentQuestionNumber = 0;
      let quizType = ''; // どのクイズかを保持する変数

      const quizMenu = document.getElementById('quiz-menu');
      const quizContainer = document.getElementById('quiz-container');
      const instruction = document.getElementById('instruction');

      function startQuiz(type) {
        quizType = type; // クイズの種類を保存

        instruction.classList.add('hidden');
        quizMenu.classList.add('hidden');
        currentQuestionNumber = 0; // 新しいクイズ開始時に問題数をリセット

        if (type === 'times') {
          // 掛け算の場合は段選択メニューを表示
          showTimesMenu();
        } else {
          // 掛け算以外は直接問題をスタート
          generateQuestion();
        }
      }

      function showTimesMenu() {
        let buttons = '';
        for (let i = 1; i <= 9; i++) {
          buttons += `<input type="button" onclick="startTimesQuiz(${i})" value="${i}の段">`;
        }
        buttons += `<br><input type="button" onclick="startTimesQuiz('random')" value="ランダムなかけざん">`;
        buttons += `<br><input type="button" onclick="resetQuiz()" value="メニューに戻る">`;
        
        quizContainer.innerHTML = `<p>段を選んでね</p>${buttons}`;
      }

      function startTimesQuiz(dan) {
        // 掛け算の段を保存
        quizType = `times_${dan}`;
        generateQuestion();
      }

      function generateQuestion() {
        let num1, num2, questionText;
        currentQuestionNumber++;

        // クイズの種類に応じて問題を作成
        if (quizType === 'plus') {
          num1 = Math.floor(Math.random() * 100);
          num2 = Math.floor(Math.random() * 100);
          questionText = `${num1} + ${num2} = ?`;
          currentAnswer = num1 + num2;
        } else if (quizType === 'minus') {
          num1 = Math.floor(Math.random() * 100);
          num2 = Math.floor(Math.random() * 100);
          if (num1 < num2) {
            [num1, num2] = [num2, num1];
          }
          questionText = `${num1} - ${num2} = ?`;
          currentAnswer = num1 - num2;
        } else if (quizType.startsWith('times_')) {
          const dan = quizType.split('_')[1];
          if (dan === 'random') {
            num1 = Math.floor(Math.random() * 9) + 1;
            num2 = Math.floor(Math.random() * 9) + 1;
          } else {
            num1 = parseInt(dan);
            num2 = Math.floor(Math.random() * 9) + 1;
          }
          questionText = `${num1} × ${num2} = ?`;
          currentAnswer = num1 * num2;
        } else if (quizType === 'divide') {
          num2 = Math.floor(Math.random() * 10) + 1;
          let tempResult = Math.floor(Math.random() * 10) + 1;
          num1 = num2 * tempResult;
          questionText = `${num1} ÷ ${num2} = ?`;
          currentAnswer = tempResult;
        }

        quizContainer.innerHTML = `
          <p>${currentQuestionNumber}問目</p>
          <p>${questionText}</p>
          <input type="number" id="user-answer">
          <br>
          <input type="button" onclick="checkAnswer()" value="こたえる">
          <p id="result"></p>
        `;
      }

      function checkAnswer() {
        const userAnswer = document.getElementById('user-answer').value;
        const resultParagraph = document.getElementById('result');

        if (parseInt(userAnswer, 10) === currentAnswer) {
          resultParagraph.innerText = 'せいかい！';
        } else {
          resultParagraph.innerText = `ざんねん！せいかいは ${currentAnswer} です。`;
        }

        resultParagraph.innerHTML += `
          <br>
          <input type="button" onclick="generateQuestion()" value="次の問題へ">
          <input type="button" onclick="resetQuiz()" value="メニューに戻る">
        `;
      }

      function resetQuiz() {
        currentQuestionNumber = 0;
        quizContainer.innerHTML = '';
        quizMenu.classList.remove('hidden');
        instruction.classList.remove('hidden');
      }
    </script>
  </body>
</html>
